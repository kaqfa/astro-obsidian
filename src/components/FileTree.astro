---
import type { FileTreeItem } from "../lib/vault";

interface Props {
  tree: FileTreeItem[];
  depth?: number;
}

const { tree, depth = 0 } = Astro.props;
---

{
  tree.map((item) => {
    const isFolder = item.type === "folder";
    const indent = depth * 12;

    if (isFolder) {
      return (
        <details class="folder-item" open={depth === 0}>
          <summary
            class="flex items-center gap-2 py-1 px-2 hover:bg-bg-tertiary rounded cursor-pointer text-text-secondary hover:text-text-primary transition-colors group"
            style={`padding-left: ${indent + 8}px`}
          >
            <svg
              class="w-4 h-4 transition-transform folder-icon shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              />
            </svg>
            <svg
              class="w-4 h-4 text-accent shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
              />
            </svg>
            <span class="truncate font-medium text-base">{item.name}</span>
          </summary>
          <div class="folder-content">
            {item.children && (
              <Astro.self tree={item.children} depth={depth + 1} />
            )}
          </div>
        </details>
      );
    } else {
      // Remove .md extension from path
      const href = `/notes/${item.path.replace(/\.md$/, "")}`;
      return (
        <a
          href={href}
          class="flex items-center gap-2 py-1 px-2 hover:bg-bg-tertiary rounded text-text-muted hover:text-accent transition-colors text-base group"
          style={`padding-left: ${indent + 8}px`}
        >
          <svg
            class="w-4 h-4 shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
          <span class="truncate text-base">
            {item.name.replace(/\.md$/, "")}
          </span>
        </a>
      );
    }
  })
}

<style>
  .folder-item[open] > summary .folder-icon {
    transform: rotate(90deg);
  }

  .folder-content {
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  details {
    margin: 0;
  }

  summary {
    list-style: none;
    line-height: 1.3;
  }

  summary::-webkit-details-marker {
    display: none;
  }
</style>
